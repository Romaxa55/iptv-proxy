version: "3"
services:
  iptv-proxy:
    image: ghcr.io/romaxa55/iptv-proxy/iptv-proxy:latest
#     build:
#       context: .
#       dockerfile: Dockerfile
    volumes:
      - ./iptv:/root/iptv
    container_name: iptv-proxy
    restart: on-failure
    env_file: .env
    ports:
      - 8080:8080
    environment:
      USER: ${USER_NAME:-test}
      PASSWORD: ${PASSWORD:-password}
      BITRATE_VIDEO: 512k
      BITRATE_AUDIO: 128k
      SCALE: -1:720
      CRF: 40
      PRESET: ultrafast
      HLS_TIME: 30
      HLS_LIST_SIZE: 20
    networks: [public]
    labels:
      - traefik.enable=true
      - traefik.http.routers.iptv-proxy.tls=true
      - traefik.http.routers.iptv-proxy.rule=Host(`iptv.roshamagin.site`)
      - traefik.http.routers.iptv-proxy.entrypoints=websecure
      - traefik.http.routers.iptv-proxy.tls.certresolver=myresolver
      - traefik.http.services.iptv-proxy.loadbalancer.server.port=8080

networks:
  public:
     external: true
